{% extends "base.html" %}
{% include "scheduler/nav.html" %}

{% block page_content %}
<section class="section">
<div class="columns">
    <div class="column has-text-centered box">
        <p>ตัวกรองรายการ</p>
        <div class="field">
            <label class="radio">
                <input type="radio" name="toggle" value="all" checked="true">
                ทั้งหมด
            </label>
            <label class="radio">
                <input type="radio" name="toggle" value="some">
                ห้องที่ดูแล
            </label>
        </div>
    </div>
</div>
<div class="columns">
    <div class="column">
        <table id="data" class="table is-fullwidth">
            <thead>
            <th>หมายเลข</th>
            <th>วิทยาเขต</th>
            <th>ผู้จอง</th>
            <th>จองเมื่อ</th>
            <th>จุดประสงค์</th>
            <th>เริ่ม</th>
            <th>สิ้นสุด</th>
            <th>หมายเหตุ</th>
            <th>ยกเลิกเมื่อ</th>
            <th>ประเภท</th>
            </thead>
        </table>
        <div class="buttons is-centered">
            <a href="{{ url_for('room.index') }}" class="button is-light">กลับ</a>
        </div>
    </div>
</div>
</section>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>
        $.fn.dataTable.moment('lll');
        $(document).ready(function () {
            let table = $('#data').DataTable({
                ajax: '{{ url_for('room.get_room_event_list') }}',
                order: [[3, 'desc'], [5, 'asc']],
                serverSide: false,
                processing: true,
                columns: [
                    { data: 'room_number' },
                    { data: 'room_location' },
                    { data: 'creator' },
                    {
                        data: 'created_at',
                        render: function(data, type) {
                            return moment(data).format('lll')
                        }
                    },
                    { data: 'title' },
                    {
                        data: 'start',
                        render: function(data, type) {
                            return moment(data).format('lll')
                        }
                    },
                    {
                        data: 'end',
                        render: function(data, type) {
                            return moment(data).format('lll')
                        }
                    },
                    {
                        data: 'note',
                        render: function(data, type) {
                            if (data) {
                                return '<span class="has-text-danger">' + data + '</span>'
                            } else {
                                return ''
                            }
                        }
                    },
                    {
                        data: 'cancelled_at',
                        render: function(data, type) {
                            if (data !== null) {
                                return moment(data).format('lll')
                            } else {
                                return null
                            }
                        }
                    },
                    { data: 'category' },
                ],
            });
            $('input[name="toggle"]').change(function() {
                let selected_value = $("input[name='toggle']:checked").val();
                let url = '/room/api/admin/events' + '?query=' + selected_value
                table.ajax.url(url).load()
            })
        });
    </script>
{% endblock %}